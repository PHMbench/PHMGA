

# 轴承变转速工况故障诊断分析报告

本报告旨在分析所提供的轴承振动信号，以识别潜在的健康状况和故障模式。根据用户指令，本次分析的数据集包含变转速工况下的信号，这意味着故障特征会随转速变化而改变。参考集与测试集均包含三种状态：健康（Health）、内圈故障（Inner Race Fault）和外圈故障（Outer Race Fault）。核心目标是通过将测试信号与参考集进行对比，实现对每个测试信号的精确分类。

## 1. 流程概览

本次诊断任务的处理流程从两个独立的输入通道（`ch1` 和 `ch2`）采集原始振动信号开始。为了从复杂的变转速信号中提取有效的故障特征，我们设计并执行了一个多层次的信号处理与特征提取流程（DAG）：

- **信号预处理**:

  - 对两个通道的原始信号 (`ch1`, `ch2`) 分别应用了 **希尔伯特包络（Hilbert Envelope）** 和 **连续小波变换（Continuous Wavelet Transform）**。希尔ber特包络主要用于解调幅值调制信息，而小波变换则非常适合分析变转速这类非平稳信号的时频特性。
- **特征提取**:

  - **时域与频域统计特征**: 直接从原始信号 `ch1` 和 `ch2` 中提取了多种统计指标，例如峰度（Kurtosis）、峭度因子（Crest Factor）、均方根（RMS）、波形因子（Shape Factor）等。
  - **包络谱特征**: 对希尔伯特包络信号进行 **快速傅里叶变换（FFT）**，得到包络谱。并从包络谱中提取了均值（Mean）、标准差（Std）、峰度（Kurtosis）和偏度（Skew）等特征。
  - **小波特征**: 对小波变换后的时频矩阵，我们计算了其在不同尺度（Scale）上的能量均值（Mean）和标准差（Std）。
  - **多通道特征**: 计算了两个通道间的 **相干性（Coherence）**，并提取了其均值和最大值，以评估通道间的线性相关性。
- **分类与诊断**:

  - 所有提取出的特征被用于训练和评估一个机器学习分类模型。最终，通过一个 **集成模型（Ensemble Model）** 结合所有特征的优势，对测试信号的健康状态进行最终分类。

## 2. 特征洞察

本次分析未提供特征间的相似度统计数据（`similarity_stats` 为空），因此无法对特征的区分度进行直接的量化比较。然而，我们可以通过各特征在机器学习模型中的独立表现来间接评估其有效性。

- **表现最优的特征**:

  - `mean_03_wavelet_transform_03_ch1` (F1-score: 0.994): 基于 **`ch1` 小波变换的均值特征** 取得了近乎完美的分类效果。这表明小波变换成功地捕捉到了与转速变化无关的、稳定的故障模式能量分布，是本次诊断任务中最具区分度的特征。
  - `wavelet_transform_03_ch1` (F1-score: 0.991): 完整的小波变换时频图本身也包含极高的信息量，分类准确率极高。
  - `fft_01_hilbert_envelope_01_ch1` (F1-score: 0.967): 基于 **`ch1` 包络谱的分析** 也表现出色。这是经典的轴承故障诊断方法，通过解调发现故障引起的周期性冲击，在变转速工况下依然有效。
- **表现最差的特征**:

  - `spectral_flatness_06_ch2` (F1-score: 0.168): **`ch2` 的谱平坦度** 几乎没有提供任何有用的分类信息。
  - 绝大多数来自 `ch2` 的特征（如 `rms_06_ch2`, `hilbert_envelope_02_ch2` 等）以及部分单值统计量（如 `crest_factor_07_ch1`）的 F1 分数均在 0.33 左右，这与三分类问题中的随机猜测水平相当。
- **原因推测**:

  - **通道 `ch1` 是关键信息源**。无论是小波分析还是包络谱分析，`ch1` 提供的信号质量远高于 `ch2`。这可能与传感器的安装位置有关，`ch1` 的位置更接近故障源，能够更清晰地捕捉到故障冲击。
  - **`ch2` 可能存在噪声干扰或信息冗余**。`ch2` 信号的特征区分度普遍较低，表明该通道可能受到严重噪声污染，或者其测量位置无法有效反映轴承的健康状态。
  - **高级信号处理方法的优越性**。在变转速工况下，小波变换和包络谱分析等能够处理非平稳信号的方法，显著优于传统的时域统计指标（如RMS、Kurtosis），后者因无法解耦转速变化和故障冲击而失效。

## 3. 模型评估

为了对轴承的健康状态进行准确分类，我们评估了基于不同特征的机器学习模型性能，并构建了一个集成模型以综合所有特征的诊断能力。详细性能指标如下表所示，其中交叉验证（CV）结果反映了模型在不同数据子集上的泛化能力。

| 特征/模型                                  |           Accuracy |           F1 Score | CV Accuracy | CV F1 Score | CV Accuracy Std |     CV F1 Std |
| :----------------------------------------- | -----------------: | -----------------: | ----------: | ----------: | --------------: | ------------: |
| hilbert_envelope_01_ch1                    |           0.706539 |           0.709033 |    0.758891 |    0.754649 |        0.050594 |      0.055472 |
| hilbert_envelope_02_ch2                    |           0.339629 |           0.338302 |    0.320853 |    0.319765 |        0.007129 |      0.006871 |
| wavelet_transform_03_ch1                   |           0.991385 |           0.991385 |    0.988072 |    0.988065 |        0.008678 |      0.008691 |
| wavelet_transform_04_ch2                   |           0.341507 |           0.338874 |    0.308924 |    0.304770 |        0.007241 |      0.008161 |
| kurtosis_05_ch1                            |           0.392092 |           0.391570 |    0.407334 |    0.407307 |        0.007945 |      0.008217 |
| rms_06_ch2                                 |           0.339518 |           0.339495 |    0.335984 |    0.335905 |        0.007096 |      0.007089 |
| fft_01_hilbert_envelope_01_ch1             |           0.966424 |           0.966527 |    0.978131 |    0.978082 |        0.013140 |      0.013155 |
| fft_02_hilbert_envelope_02_ch2             |           0.341286 |           0.339787 |    0.316877 |    0.316231 |        0.005372 |      0.005857 |
| mean_03_wavelet_transform_03_ch1           |           0.994036 |           0.994035 |    0.997460 |    0.997459 |        0.002203 |      0.002205 |
| std_04_wavelet_transform_04_ch2            |           0.372322 |           0.371580 |    0.371880 |    0.369775 |        0.025249 |      0.024441 |
| spectral_kurtosis_05_ch1                   |           0.392092 |           0.391570 |    0.407334 |    0.407307 |        0.007945 |      0.008217 |
| spectral_flatness_06_ch2                   |           0.333444 |           0.167892 |    0.330572 |    0.166595 |        0.004159 |      0.001950 |
| coherence_07_ch1_ch2                       |           0.360062 |           0.359801 |    0.369781 |    0.369117 |        0.003902 |      0.004314 |
| mean_01_fft_01_hilbert_envelope_01_ch1     |           0.654738 |           0.657363 |    0.678706 |    0.678195 |        0.009204 |      0.010631 |
| kurtosis_02_fft_01_hilbert_envelope_01_ch1 |           0.586812 |           0.590621 |    0.529379 |    0.535723 |        0.059563 |      0.056071 |
| std_03_fft_02_hilbert_envelope_02_ch2      |           0.329689 |           0.329697 |    0.326927 |    0.326968 |        0.011221 |      0.011365 |
| skew_04_fft_02_hilbert_envelope_02_ch2     |           0.330683 |           0.330621 |    0.333554 |    0.333495 |        0.004141 |      0.004046 |
| mean_05_coherence_07_ch1_ch2               |           0.332339 |           0.332322 |    0.334769 |    0.334596 |        0.003572 |      0.003538 |
| max_06_coherence_07_ch1_ch2                |           0.340623 |           0.340616 |    0.333665 |    0.333521 |        0.003788 |      0.003845 |
| crest_factor_07_ch1                        |           0.352883 |           0.351947 |    0.336315 |    0.334518 |        0.021045 |      0.021810 |
| shape_factor_08_ch2                        |           0.357301 |           0.357108 |    0.375856 |    0.374888 |        0.003961 |      0.004455 |
| **ensemble**                         | **0.993042** | **0.993037** | **/** | **/** |   **nan** | **nan** |

**评估摘要**:

- **集成模型表现卓越**：最终的 **集成模型（Ensemble）** 取得了 **99.3%** 的准确率和F1分数。这一结果证明，通过整合多个维度的特征（尤其是 `ch1` 的小波和包络谱特征），模型能够非常可靠地对轴承在变转速工况下的三种状态（健康、内圈故障、外圈故障）进行区分。
- **单特征性能差异巨大**：如前所述，不同特征的诊断能力相差悬殊。这突显了在复杂工况下选择正确信号处理方法和特征的重要性。

## 4. 结论与建议

**诊断结论**:

- 本次分析所采用的诊断流程 **非常成功**。集成模型达到了 99.3% 的分类准确率，表明该方法能够有效、可靠地识别变转速工况下的轴承健康状态及内、外圈故障。
- 诊断模型的成功主要归功于对 **`ch1` 信号的深度处理**，特别是 **小波变换** 和 **包络谱分析** 两种技术，它们是应对变转速挑战的关键。

**维护建议**:

1. **部署诊断模型**：鉴于集成模型的高精度和高可靠性，建议将此分析流程和模型部署到实际的设备健康监测系统中，用于在线、自动化的故障预警和诊断。
2. **审查 `ch2` 传感器**：通道 `ch2` 及其衍生特征在本轮分析中几乎未提供有效信息。建议对 `ch2` 对应的传感器进行检查，包括其 **物理安装位置、连接线路和自身健康状况**，以确认其是否工作正常或安装位置是否合理。若确认无效，可在未来监测中考虑将其移除，以降低数据采集和计算成本。
3. **优化特征集**：为提高计算效率，未来可考虑精简特征集，仅保留 `wavelet_transform_03_ch1`, `fft_01_hilbert_envelope_01_ch1` 等少数几个表现最优的特征进行建模。这可以在基本不损失精度的情况下，大幅减少计算负担。

## 5. Code 代码部分

在数据处理流程（DAG）中，小波变换（`wavelet_transform`）等计算密集型算子是潜在的性能瓶颈。以下代码片段展示了如何通过并行化处理来优化该算子，以提高大规模数据集分析的效率。这里我们使用 `joblib` 库对多个信号的连续小波变换（CWT）进行并行计算。

```python
import numpy as np
import pywt
from joblib import Parallel, delayed

def compute_cwt(signal, scales, wavelet_name):
    """
    计算单个信号的连续小波变换。
    Args:
        signal (np.ndarray): 一维输入信号。
        scales (np.ndarray): 小波变换的尺度数组。
        wavelet_name (str): 小波函数名称, e.g., 'morl'。
    Returns:
        np.ndarray: CWT系数矩阵。
    """
    # 确保信号是一维的
    if signal.ndim > 1:
        signal = signal.flatten()
  
    coefficients, _ = pywt.cwt(signal, scales, wavelet_name)
    return coefficients

def optimized_wavelet_transform_on_batch(signals_batch, scales, wavelet_name='morl', n_jobs=-1):
    """
    使用并行计算优化对一批信号的小波变换处理。

    Args:
        signals_batch (list of np.ndarray or np.ndarray): 包含多个信号的列表或二维数组。
        scales (np.ndarray): 小波变换的尺度数组。
        wavelet_name (str): 小波函数名称。
        n_jobs (int): 并行处理使用的CPU核心数。-1表示使用所有可用核心。

    Returns:
        list of np.ndarray: 每个信号对应的CWT系数矩阵列表。
    """
    # 使用joblib的Parallel和delayed函数实现并行化
    # delayed(compute_cwt) 创建一个函数的“延迟”版本
    # Parallel(...) 会在多个CPU核心上并行执行这些延迟的函数调用
    cwt_results = Parallel(n_jobs=n_jobs)(
        delayed(compute_cwt)(signal, scales, wavelet_name) for signal in signals_batch
    )
  
    return cwt_results

# --- 示例 ---
# 假设我们有一批信号数据 (例如，100个信号，每个信号长度为4096)
# signals_to_process = np.random.rand(100, 4096) 
# scales_to_use = np.arange(1, 129)

# # 调用优化后的函数
# # cwt_matrices = optimized_wavelet_transform_on_batch(signals_to_process, scales_to_use)

# print("通过并行化，小波变换算子的计算效率得到显著提升，特别是在处理大量信号时。")

```

**优化说明**：上述代码通过 `joblib.Parallel` 将原本需要串行循环处理的多个信号的小波变换任务，分配到多个CPU核心上并行执行。这种方式可以成倍缩短处理时间，尤其适用于包含大量测试样本的诊断场景，是提升整个DAG执行效率的有效手段。
